<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crypto Prices with CoinGecko API</title>
    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      body {
        background-color: #f4f4f9;
        color: #333;
      }
      h1 {
        margin-top: 20px;
        color: #444;
      }
      .navbar {
        padding: 1rem;
        background-color: #01112a;
      }
      .navbar-brand img {
        height: 40px;
        margin-right: 10px;
      }
      .crypto-card img {
        width: 40px;
      }
      .price {
        font-size: 1.2em;
        font-weight: bold;
        color: #00aaff;
      }
      .loading {
        font-size: 1.5em;
        color: #00aaff;
      }
      .price-change {
        font-size: 1em;
        font-weight: bold;
      }
      .price-change.text-success {
        color: #28a745;
      }
      .price-change.text-danger {
        color: #dc3545;
      }
      .news-card img {
        width: 50px;
      }
      .news-title {
        font-size: 1.1em;
        font-weight: bold;
      }
      .news-card {
        max-height: 850px; /* Set a maximum height for the news card */
        overflow: hidden; /* Hide content that exceeds the max-height */
        display: flex;
        flex-direction: column;
      }

      .news-card img {
        width: 100%; /* Make the image take up the full width */
        max-height: 150px; /* Set a max height for the image */
        object-fit: cover; /* Ensure the image covers the area without distortion */
      }

      .news-card .card-body {
        flex-grow: 1; /* Allow the body content to expand to fill available space */
      }

      .news-title {
        font-size: 1.1em;
        font-weight: bold;
        overflow: hidden;
        text-overflow: ellipsis; /* Add ellipsis if the title overflows */
        white-space: nowrap; /* Prevent the title from wrapping */
      }

      .card-text {
        font-size: 0.9em;
        text-overflow: ellipsis; /* Add ellipsis if description overflows */
        overflow: hidden;
        white-space: nowrap; /* Prevent the description from wrapping */
      }
      /* Dark Mode Custom Styles */
      body.bg-dark {
        background-color: #343a40;
        color: #fff;
      }
      .bg-dark .card {
        background-color: #495057;
        border: none;
      }
      .bg-dark .card-body {
        color: #fff;
      }
      .bg-dark .price {
        color: #17a2b8;
      }
      .bg-dark .pagination .page-link {
        color: #fff;
        background-color: #495057;
        border-color: #495057;
      }
      .bg-dark .pagination .page-item.active .page-link {
        background-color: #007bff;
        border-color: #007bff;
      }
      .table-container {
        max-height: 400px;
        overflow-y: scroll;
      }
      .website-bammer {
        width: 100%;
        background-image: url(image/);
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <!-- Left Side -->
        <a class="navbar-brand d-flex align-items-center" href="#">
          <img src="https://via.placeholder.com/40" alt="Logo" />
          <span class="fw-bold">Website Name</span>
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="#">Crypto</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">Exchange Rate</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#">News</a>
            </li>
          </ul>
          <!-- Right Side -->
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="btn btn-outline-primary me-2" href="#">Login</a>
            </li>
            <li class="nav-item">
              <a class="btn btn-primary" href="#">Sign Up</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div class="col website-banner"></div>
      </div>
    </div>

    <div class="container text-center">
      <div id="loading" class="loading mt-4">Loading...</div>
      <div id="crypto-container" class="row mt-4">
        <!-- Crypto data will be loaded here -->
      </div>
      <nav aria-label="Page navigation" class="mt-4">
        <ul id="pagination" class="pagination justify-content-center">
          <!-- Pagination buttons will be generated here -->
        </ul>
      </nav>
    </div>

    <div class="container text-center mt-5">
      <h2>Latest News</h2>
      <div id="news-container" class="row mt-4">
        <!-- News data will be loaded here -->
      </div>
      <nav aria-label="Page navigation" class="mt-4">
        <ul id="news-pagination" class="pagination justify-content-center">
          <!-- Pagination buttons for news will be generated here -->
        </ul>
      </nav>
    </div>

    <div class="container mt-5">
      <h2>Crypto Exchange Data</h2>
      <div class="table-container mt-4">
        <table class="table table-striped table-bordered">
          <thead>
            <tr>
              <th>Rank</th>
              <th>Logo</th>
              <th>Name</th>
              <th>Trust Score</th>
              <th>24h Volume (Normalized)</th>
              <th>Monthly Visits</th>
              <th>Chart</th>
            </tr>
          </thead>
          <tbody id="exchange-table-body">
            <!-- Exchange data will be loaded here -->
          </tbody>
        </table>
      </div>
      <button id="load-more-btn" class="btn btn-primary">Load More</button>
    </div>

    <!-- Bootstrap and jQuery (for Bootstrap JS components) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
      const container = document.getElementById("crypto-container");
      const pagination = document.getElementById("pagination");
      const loading = document.getElementById("loading");
      const newsContainer = document.getElementById("news-container");
      const newsPagination = document.getElementById("news-pagination");

      const itemsPerPage = 9; // Number of items per page for crypto
      const itemsPerPageNews = 3; // Number of items per page for news
      let currentPage = 1;
      let currentNewsPage = 1;
      let cryptoData = [];
      let newsData = [];

      async function fetchCryptoPrices() {
        try {
          const response = await fetch(
            "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=200&page=1"
          );
          cryptoData = await response.json();
          loading.style.display = "none"; // Hide loading message
          renderCryptoPage(currentPage);
          setupCryptoPagination();
        } catch (error) {
          console.error("Error fetching data:", error);
          container.innerHTML =
            '<p class="text-danger">Failed to load data. Please try again later.</p>';
        }
      }

      async function fetchNews() {
        try {
          const response = await fetch("https://api.coingecko.com/api/v3/news");
          const data = await response.json();

          // Now access the 'data' array from the response object
          newsData = data.data; // Access the news data inside the 'data' property

          renderNewsPage(currentNewsPage);
          setupNewsPagination();
        } catch (error) {
          console.error("Error fetching news:", error);
          newsContainer.innerHTML =
            '<p class="text-danger">Failed to load news. Please try again later.</p>';
        }
      }

      function renderCryptoPage(page) {
        container.innerHTML = ""; // Clear existing data
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageData = cryptoData.slice(startIndex, endIndex);

        pageData.forEach((coin) => {
          const cryptoElement = document.createElement("div");
          cryptoElement.classList.add(
            "col-6",
            "col-sm-6",
            "col-md-4",
            "col-lg-4",
            "mb-4"
          ); // Responsive columns

          // Create a link wrapping the entire card
          const cardLink = document.createElement("a");
          cardLink.href = `https://www.coingecko.com/en/coins/${coin.id}`;
          cardLink.target = "_blank"; // Open in a new tab
          cardLink.classList.add("text-decoration-none");

          // Card content
          cardLink.innerHTML = `
            <div class="card crypto-card shadow">
              <div class="card-body text-center">
                <img src="${coin.image}" alt="${coin.name}" class="mb-3" />
                <h5 class="card-title">${coin.name}</h5>
                <p class="price">$${coin.current_price}</p>
                <p class="card-text text-muted">Market Cap: $${coin.market_cap.toLocaleString()}</p>
                <p class="price-change ${
                  coin.price_change_percentage_24h > 0
                    ? "text-success"
                    : "text-danger"
                }">
                  ${coin.price_change_percentage_24h.toFixed(2)}% 24h
                </p>
              </div>
            </div>
          `;

          // Append the card link to the container
          cryptoElement.appendChild(cardLink);
          container.appendChild(cryptoElement);
        });
      }

      function renderNewsPage(page) {
        newsContainer.innerHTML = ""; // Clear existing data
        const startIndex = (page - 1) * itemsPerPageNews;
        const endIndex = startIndex + itemsPerPageNews;
        const pageData = newsData.slice(startIndex, endIndex);

        pageData.forEach((newsItem) => {
          console.log(newsItem); // Log the newsItem for debugging

          const newsElement = document.createElement("div");
          newsElement.classList.add("col-12", "col-md-4", "mb-4");

          // Use thumb_2x for the image URL, with a fallback if it's missing
          const imageUrl =
            newsItem.thumb_2x || "https://via.placeholder.com/150"; // Fallback image

          // Construct the card content for the news item
          newsElement.innerHTML = `
      <div class="card news-card shadow">
        <div class="card-body">
          <img src="${imageUrl}" alt="${newsItem.title}" class="mb-3" />
          <h5 class="card-title news-title">${newsItem.title}</h5>
          <p class="card-text">${newsItem.description}</p>
          <a href="${newsItem.url}" target="_blank" class="btn btn-primary">Read More</a>
        </div>
      </div>
    `;

          // Append the news card to the container
          newsContainer.appendChild(newsElement);
        });
      }

      function setupCryptoPagination() {
        const pageCount = Math.ceil(cryptoData.length / itemsPerPage);
        pagination.innerHTML = ""; // Clear existing pagination buttons

        for (let i = 1; i <= pageCount; i++) {
          const pageItem = document.createElement("li");
          pageItem.classList.add("page-item");
          pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;

          pageItem.querySelector("a").addEventListener("click", (e) => {
            e.preventDefault();
            currentPage = i;
            renderCryptoPage(currentPage);
          });

          pagination.appendChild(pageItem);
        }
      }

      function setupNewsPagination() {
        const pageCount = Math.ceil(newsData.length / itemsPerPageNews);
        newsPagination.innerHTML = ""; // Clear existing pagination buttons

        for (let i = 1; i <= pageCount; i++) {
          const pageItem = document.createElement("li");
          pageItem.classList.add("page-item");
          pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;

          pageItem.querySelector("a").addEventListener("click", (e) => {
            e.preventDefault();
            currentNewsPage = i;
            renderNewsPage(currentNewsPage);
          });

          newsPagination.appendChild(pageItem);
        }
      }

      // Initialize the page by fetching crypto data and news
      fetchCryptoPrices();
      fetchNews();

      const exchangeTableBody = document.getElementById("exchange-table-body");
      const loadMoreBtn = document.getElementById("load-more-btn");

      let exchangesData = [];
      let currentExchangePage = 1;
      const exchangesPerPage = 10;

      async function fetchExchangeData() {
        try {
          const response = await fetch(
            "https://api.coingecko.com/api/v3/exchanges?per_page=100&page=1"
          );
          exchangesData = await response.json();
          renderExchangeTable(currentExchangePage);
        } catch (error) {
          console.error("Error fetching data:", error);
          exchangeTableBody.innerHTML =
            '<tr><td colspan="7" class="text-danger">Failed to load data. Please try again later.</td></tr>';
        }
      }

      function renderExchangeTable(page) {
        const startIndex = (page - 1) * exchangesPerPage;
        const endIndex = startIndex + exchangesPerPage;
        const pageData = exchangesData.slice(startIndex, endIndex);

        pageData.forEach((exchange) => {
          const row = document.createElement("tr");

          row.innerHTML = `
      <td>${exchange.trust_score_rank}</td>
      <td><img src="${exchange.image}" alt="${exchange.name}" width="30"></td>
      <td>${exchange.name}</td>
      <td>${exchange.trust_score}</td>
      <td>$${exchange.trade_volume_24h_btc.toLocaleString()}</td>
      <td>${exchange.monthly_visits}</td>
      <td><a href="${exchange.url}" target="_blank">Chart</a></td>
    `;
          exchangeTableBody.appendChild(row);
        });
      }

      loadMoreBtn.addEventListener("click", () => {
        currentExchangePage++;
        renderExchangeTable(currentExchangePage);
        if (currentExchangePage * exchangesPerPage >= exchangesData.length) {
          loadMoreBtn.style.display = "none";
        }
      });

      // Initialize the page
      fetchExchangeData();
    </script>
  </body>
</html>
